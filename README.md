В контроллере CatalogController реализован метод sendPaymentRequest(), на который пользователь с формы отравляет данные для оплаты объявления, предполагается, что на стороне платежной системы произведётся редирект и пользователь перейдет на сервис пополнения баланса

Метод getPaymentResponseAndUpdateAmount() принимает данные с платежной системы, получает секретный ключ и вычисляет хэш сумму по алгоритму Если проверка пройдена , оплата поступает в таблицу в базе данных в столбец amount я реализовал Advert модель и сделал миграцию бд с добавлением нового поля amount в котором отражается баланс

Маршрутизация в routes/api

Индексный метод контроллера переработан под новую работу сервиса, отражает только оплаченные объявления и бесплатные

Почасовая оплата реализована в классе Payment , schedule запускает агента каждый час и производит списание 1/24 от тарифа

Постарался реализовать чанки для записи в бд